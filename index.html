<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ear Training Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=0.8, user-scalable=no">

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f3f3f3;
            color: #333;
            margin: 0;
            padding: 0;
        }
        .keyboard-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .keyboard {
            display: flex;
        }
        .octave {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .white, .black {
            height: 120px;
            width: 30px;
            margin: 1px;
            cursor: pointer;
        }
        .white {
            background-color: white;
            border: 1px solid #ccc;
            z-index: 1;
        }
        .black {
            background-color: black;
            width: 20px;
            margin-left: -10px;
            z-index: 2;
        }
        #top-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: #333;
            color: white;
        }
        #feedback {
            text-align: center;
            margin-top: 20px;
            font-size: 20px;
        }
    </style>
</head>
<body>

    <!-- Game Interface -->
    <div id="orientation-overlay" style="display: none;">
        <p>Please rotate your device to landscape mode for the best experience.</p>
    </div>

    <div class="keyboard-container">
        <div class="keyboard">
            <div class="octave">
                <div class="octave-label c4-label">C4</div>
                <div class="white" data-freq="261.63">C</div>
                <div class="black c-sharp" data-freq="277.18">C#<br>D♭</div>
                <div class="white" data-freq="293.66">D</div>
                <div class="black d-sharp" data-freq="311.13">D#<br>E♭</div>
                <div class="white" data-freq="329.63">E</div>
                <div class="white" data-freq="349.23">F</div>
                <div class="black f-sharp" data-freq="369.99">F#<br>G♭</div>
                <div class="white" data-freq="392.00">G</div>
                <div class="black g-sharp" data-freq="415.30">G#<br>A♭</div>
                <div class="white" data-freq="440.00">A</div>
                <div class="black a-sharp" data-freq="466.16">A#<br>B♭</div>
                <div class="white" data-freq="493.88">B</div>
            </div>
            <div class="octave">
                <div class="octave-label c5-label">C5</div>
                <div class="white" data-freq="523.25">C</div>
                <div class="black c-sharp" data-freq="554.37">C#<br>D♭</div>
                <div class="white" data-freq="587.33">D</div>
                <div class="black d-sharp" data-freq="622.25">D#<br>E♭</div>
                <div class="white" data-freq="659.26">E</div>
                <div class="white" data-freq="698.46">F</div>
                <div class="black f-sharp" data-freq="739.99">F#<br>G♭</div>
                <div class="white" data-freq="783.99">G</div>
                <div class="black g-sharp" data-freq="830.61">G#<br>A♭</div>
                <div class="white" data-freq="880.00">A</div>
                <div class="black a-sharp" data-freq="932.33">A#<br>B♭</div>
                <div class="white" data-freq="987.77">B</div>
            </div>
        </div>
    </div>

    <div id="top-bar">
        <button id="start-game-button">Start Game</button>
        <button id="recap-button">Recap Note</button>
        <button id="play-again-button" style="display: none;">Play Again</button>
        <button id="play-all-notes-button">Play All Notes</button>
        <div id="info-group">
            <span id="score">Score: 0</span>
            <span id="high-score">High Score: 0</span>
            <span id="time-remaining">Time: 90</span>
        </div>
    </div>

    <p id="feedback"></p>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let score = 0;
        let highScore = 0;
        let timeLeft = 90;
        let timer;
        let targetFrequency;
        let inputEnabled = true;
        const orientationOverlay = document.getElementById('orientation-overlay');
        const keyboardContainer = document.querySelector('.keyboard-container');
        const keyElements = document.querySelectorAll('.white, .black');
        const assetsPath = './assets/'; // Path to the sound assets

        // Frequency mapping to the corresponding sound files
        const soundFiles = {
            "261.63": "C4.mp3",
            "277.18": "C4_sharp.mp3",
            "293.66": "D4.mp3",
            "311.13": "D4_sharp.mp3",
            "329.63": "E4.mp3",
            "349.23": "F4.mp3",
            "369.99": "F4_sharp.mp3",
            "392.00": "G4.mp3",
            "415.30": "G4_sharp.mp3",
            "440.00": "A4.mp3",
            "466.16": "A4_sharp.mp3",
            "493.88": "B4.mp3",
            "523.25": "C5.mp3",
            "554.37": "C5_sharp.mp3",
            "587.33": "D5.mp3",
            "622.25": "D5_sharp.mp3",
            "659.26": "E5.mp3",
            "698.46": "F5.mp3",
            "739.99": "F5_sharp.mp3",
            "783.99": "G5.mp3",
            "830.61": "G5_sharp.mp3",
            "880.00": "A5.mp3",
            "932.33": "A5_sharp.mp3",
            "987.77": "B5.mp3"
        };

        // Function to check device orientation
        function checkOrientation() {
            if (isMobileOrTablet()) {
                if (window.innerWidth < window.innerHeight) {
                    orientationOverlay.style.display = 'flex';
                    keyboardContainer.style.display = 'none';
                    document.getElementById('top-bar').style.display = 'none';
                } else {
                    orientationOverlay.style.display = 'none';
                    keyboardContainer.style.display = 'flex';
                    document.getElementById('top-bar').style.display = 'flex';
                }
            }
        }

        // Function to detect mobile or tablet
        function isMobileOrTablet() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Play a sound from assets folder based on frequency
        function playSound(frequency) {
            const soundFile = soundFiles[frequency.toString()];
            const audio = new Audio(assetsPath + soundFile);
            audio.play();
        }

        // Play the feedback sound (correct or incorrect)
        function playFeedbackSound(isCorrect) {
            const feedbackSound = isCorrect ? 'correct.mp3' : 'incorrect.mp3';
            const audio = new Audio(assetsPath + feedbackSound);
            audio.play();
        }

        // Start the game logic
        function startGame() {
            score = 0;
            timeLeft = 90;
            document.getElementById('score').innerText = 'Score: ' + score;
            document.getElementById('time-remaining').innerText = 'Time: ' + timeLeft;
            document.getElementById('start-game-button').style.display = 'none';
            document.getElementById('play-again-button').style.display = 'none';
            document.getElementById('play-all-notes-button').style.display = 'none';

            timer = setInterval(function () {
                timeLeft--;
                document.getElementById('time-remaining').innerText = 'Time: ' + timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    endGame();
                }
            }, 1000);
            nextNote();
        }

        // End game logic
        function endGame() {
            if (score > highScore) {
                highScore = score;
                document.getElementById('high-score').innerText = 'High Score: ' + highScore;
            }
            document.getElementById('feedback').innerText = 'Game Over! Final Score: ' + score;
            document.getElementById('play-again-button').style.display = 'inline-block';
        }

        // Generate the next note
        function nextNote() {
            const frequencies = Object.keys(soundFiles);
            const randomIndex = Math.floor(Math.random() * frequencies.length);
            targetFrequency = parseFloat(frequencies[randomIndex]);
            playSound(targetFrequency);
            document.getElementById('feedback').innerText = 'Listen to the note and click the corresponding key.';
        }

        // Check user's answer
        function checkAnswer(frequency) {
            if (Math.abs(frequency - targetFrequency) < 2) {
                score += 10;
                playFeedbackSound(true);  // Play correct feedback sound
                nextNote();
            } else {
                score -= 5;
                playFeedbackSound(false);  // Play incorrect feedback sound
            }
            document.getElementById('score').innerText = 'Score: ' + score;
        }

        // Event listeners for keys
        keyElements.forEach(function (key) {
            key.addEventListener('click', function () {
                const frequency = parseFloat(key.getAttribute('data-freq'));
                checkAnswer(frequency);
            });
        });

        document.getElementById('start-game-button').addEventListener('click', startGame);
        document.getElementById('play-again-button').addEventListener('click', startGame);

        // Initial orientation check
        window.addEventListener('resize', checkOrientation);
        checkOrientation();
    </script>
</body>
</html>
