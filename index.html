<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play All Notes</title>
    <style>
        body { font-family: sans-serif; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test: Play All Notes</h1>
    <button id="play-all-notes">Play All Notes</button>

    <script>
        const noteFiles = {
            "C4": "Assets/C4.wav",
            "C#4": "Assets/C#4.wav",
            "D4": "Assets/D4.wav",
            "D#4": "Assets/D#4.wav",
            "E4": "Assets/E4.wav",
            "F4": "Assets/F4.wav",
            "F#4": "Assets/F#4.wav",
            "G4": "Assets/G4.wav",
            "G#4": "Assets/G#4.wav",
            "A4": "Assets/A4.wav",
            "A#4": "Assets/A#4.wav",
            "B4": "Assets/B4.wav",
            "C5": "Assets/C5.wav",
            "C#5": "Assets/C#5.wav",
            "D5": "Assets/D5.wav",
            "D#5": "Assets/D#5.wav",
            "E5": "Assets/E5.wav",
            "F5": "Assets/F5.wav",
            "F#5": "Assets/F#5.wav",
            "G5": "Assets/G5.wav",
            "G#5": "Assets/G#5.wav",
            "A5": "Assets/A5.wav",
            "A#5": "Assets/A#5.wav",
            "B5": "Assets/B5.wav"
        };

        const audioCache = {};

        // Preload all audio files
        function preloadNotes() {
            for (const note in noteFiles) {
                audioCache[note] = new Audio(noteFiles[note]);
            }
        }

        // Function to play a single note with a Promise
        function playNote(note) {
            return new Promise(resolve => {
                if (audioCache[note]) {
                    const audio = audioCache[note].cloneNode(); // Clone to allow potential overlapping if needed later
                    audio.onended = resolve;
                    audio.play();
                } else {
                    console.error(`Audio file for ${note} not preloaded.`);
                    resolve(); // Resolve even if there's an error to prevent blocking
                }
            });
        }

        // Function to play all notes at a consistent tempo
        async function playAllNotes(tempo = 120) { // Tempo in beats per minute
            const allNotes = Object.keys(noteFiles);
            const secondsPerBeat = 60 / tempo;
            const noteDuration = secondsPerBeat; // Assuming each note is a quarter note for now

            for (let i = 0; i < allNotes.length; i++) {
                const startTime = performance.now();
                await playNote(allNotes[i]);
                const endTime = performance.now();
                const actualPlayTime = (endTime - startTime) / 1000;
                const timeToWait = Math.max(0, (noteDuration * 1000) - (actualPlayTime * 1000));

                if (i < allNotes.length - 1 && timeToWait > 0) {
                    await new Promise(resolve => setTimeout(resolve, timeToWait));
                }
            }
        }

        // Preload notes when the page loads
        window.onload = preloadNotes;

        // Button event listener to start playing all notes
        document.getElementById("play-all-notes").addEventListener("click", () => playAllNotes(100)); // You can adjust the tempo here
    </script>
</body>
</html>
